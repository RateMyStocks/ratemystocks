<app-share-on-social-media-speed-dial></app-share-on-social-media-speed-dial>
<p-confirmPopup></p-confirmPopup>

<div class="layout-dashboard" *ngIf="portfolio">
    <div class="p-grid">
        <div class="p-col-12 p-md-12 p-xl-9">
            <div class="p-grid">
                <div class="p-col-12 p-md-12 p-xl-4">
                    <div class="card overview-box-1 blue">
                        <div class="card-header">
                            <h6>Sample Portfolio</h6>
                            <div class="header-buttons">
                                <a href="#"><i class="pi pi-chart-bar"></i></a>
                            </div>
                        </div>
                        <div class="overview-content">
                            <h5>
                              {{ portfolio.name | truncate:[15, '...'] }}
                              <div style="font-size: small;" class="p-mt-1"><b>By <a routerLink="/profile/users/{{ portfolio.user.username }}">{{ portfolio.user.username }}</a></b></div>
                            </h5>
                        </div>
                        <div class="overview-footer">
                            <small>Last Updated {{ portfolio.lastUpdated | momentFromNowDatePipe }}</small>
                        </div>
                    </div>
                </div>
                <div class="p-col-12 p-md-12 p-xl-4">
                  <div class="card overview-box-1 teal">
                    <div class="card-header">
                        <h6>Followers</h6>
                        <div class="header-buttons">
                          <a *ngIf="!isLoggedInUserFollowing" (click)="followPortfolio()"><i class="pi pi-plus-circle"></i></a>
                          <a *ngIf="isLoggedInUserFollowing" (click)="unfollowPortfolio()" class="header-button-active"><i class="pi pi-check-circle"></i></a>
                        </div>
                    </div>
                    <div class="overview-content">
                        <h3>{{followers}}</h3>
                        <div class="overview-graph">
                          <span *ngFor="let followerCountByDay of followerCountsByDay" [ngStyle]="{'height': followerCountByDay.pixelCount, 'margin-top': noNewFollowers ? '52px' : '0px'}"><span class="graph-tooltip">{{followerCountByDay.followerCount}}</span></span>
                        </div>
                    </div>
                    <div class="overview-footer" [ngClass]="{'down': followerPercentChangeToday < 0, 'up': followerPercentChangeToday >= 0}">
                      <span *ngIf="followerPercentChangeToday != Infinity && followerPercentChangeToday !== 0">
                        <i [ngClass]="{'pi': true, 'p-mr-2': true, 'pi-arrow-down': followerPercentChangeToday < 0, 'pi-arrow-up': followerPercentChangeToday > 0}"></i>
                        <span class="p-mr-1">{{ followerPercentChangeToday.toFixed(0) }}%</span>
                        <span><span *ngIf="followerPercentChangeToday >= 0">increase</span> <span *ngIf="followerPercentChangeToday < 0">decrease</span> in followers today.</span>
                      </span>
                    </div>
                  </div>
                    <!-- <div class="card overview-box-1 teal">
                        <div class="card-header">
                            <h6>Followers</h6>
                            <div class="header-buttons">
                                <a href="#"><i class="pi pi-arrow-up"></i></a>
                            </div>
                        </div>
                        <div class="overview-content">
                            <h3>5592</h3>
                            <div class="overview-graph">
                                <span style="height: 30px;"><span class="graph-tooltip">30</span></span>
                                <span style="height: 43px;"><span class="graph-tooltip">43</span></span>
                                <span style="height: 48px;"><span class="graph-tooltip">48</span></span>
                                <span style="height: 40px;"><span class="graph-tooltip">40</span></span>
                                <span style="height: 52px;"><span class="graph-tooltip">52</span></span>
                                <span style="height: 18px;"><span class="graph-tooltip">18</span></span>
                            </div>
                        </div>
                        <div class="overview-footer down">
                            <span><i class="pi pi-arrow-down"></i> <span>12%</span> decrease in today sales</span>
                        </div>
                    </div> -->
                </div>
                <div class="p-col-12 p-md-12 p-xl-4">
                  <div class="card overview-box-1 orange">
                    <div class="card-header">
                        <h6>Visits</h6>
                        <div class="header-buttons">
                            <a><i class="pi pi-eye"></i></a>
                        </div>
                    </div>
                    <div class="overview-content">
                        <h3>{{ visitors }}</h3>
                        <div class="overview-graph">
                          <span *ngFor="let visitCount of visitCountsByDay" [ngStyle]="{'height': visitCount.pixelCount}"><span class="graph-tooltip">{{visitCount.visitCount}}</span></span>
                        </div>
                    </div>
                    <div class="overview-footer" [ngClass]="{'down': visitPercentChangeToday < 0, 'up': visitPercentChangeToday >= 0}">
                        <span *ngIf="visitPercentChangeToday != Infinity && visitPercentChangeToday !== 0">
                          <i [ngClass]="{'pi': true, 'p-mr-2': true, 'pi-arrow-down': visitPercentChangeToday < 0, 'pi-arrow-up': visitPercentChangeToday > 0}"></i>
                          <span class="p-mr-1">{{ visitPercentChangeToday.toFixed(0) }}%</span>
                          <span><span *ngIf="visitPercentChangeToday >= 0">increase</span> <span *ngIf="visitPercentChangeToday < 0">decrease</span> in visits today.</span>
                        </span>
                    </div>
                  </div>
                    <!-- <div class="card  overview-box-1 orange">
                        <div class="card-header">
                            <h6>Visits</h6>
                            <div class="header-buttons">
                                <a href="#"><i class="pi pi-arrow-up"></i></a>
                            </div>
                        </div>
                        <div class="overview-content">
                            <h3>55.95%</h3>
                            <div class="overview-graph">
                                <span style="height: 20px;"><span class="graph-tooltip">20</span></span>
                                <span style="height: 23px;"><span class="graph-tooltip">23</span></span>
                                <span style="height: 52px;"><span class="graph-tooltip">52</span></span>
                                <span style="height: 18px;"><span class="graph-tooltip">18</span></span>
                                <span style="height: 28px;"><span class="graph-tooltip">28</span></span>
                                <span style="height: 42px;"><span class="graph-tooltip">42</span></span>
                            </div>
                        </div>
                        <div class="overview-footer">
                            <span><i class="pi pi-arrow-up"></i> <span>6%</span> increase in today sales</span>
                        </div>
                    </div> -->
                </div>
                <div class="p-col-12">
                    <div class="card sale-graph">
                        <div class="card-header">
                            <h6>Holdings</h6>
                        </div>
                        <div>
                          <app-portfolio-holdings-table-readonly [portfolioStocks]="portfolioStocks" [iexStockDataMap]="iexStockDataMap"></app-portfolio-holdings-table-readonly>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="p-col-12 p-md-12 p-xl-3">
            <div class="p-grid">
              <div class="p-col-12 p-md-6 p-xl-12">
                <app-copy-page-link></app-copy-page-link>
              </div>
              <div class="p-col-12 p-md-6 p-xl-12">
                  <div class="card overview-box-1">
                      <div class="card-header">
                          <h6>Breakdowns</h6>
                          <div class="header-buttons">
                            <!-- TODO this icon needs PrimeNG 13 -->
                            <a href="#"><i class="pi pi-chart-pie"></i></a>
                          </div>
                          <!-- <p-dropdown [options]="portfolioBreakdownCategories" optionLabel="name" (onChange)="setPieChartItems($event)"></p-dropdown> -->
                      </div>
                      <div *ngIf="pieChartItems.length > 0">
                          <app-portfolio-breakdown-pie-chart [pieChartItems]="pieChartItems"></app-portfolio-breakdown-pie-chart>
                          <p-dropdown [options]="portfolioBreakdownCategories" optionLabel="name" (onChange)="setPieChartItems($event)"></p-dropdown>
                      </div>
                  </div>
              </div>
              <div class="p-col-12 p-md-6 p-xl-12">
                  <div class="card">
                      <div class="card-header">
                          <h6>Description</h6>
                      </div>
                      <div style="max-height:500px;margin:0;overflow:auto;">
                        <p>{{ portfolio?.description }}</p>
                        <p-scrollTop target="parent"></p-scrollTop>
                      </div>
                  </div>
              </div>
            </div>
        </div>

        <div class="p-col-12 p-md-6 p-xl-4">
            <div class="card">
                <div class="card-header">
                    <h6>Stats</h6>
                </div>
                <div class="p-grid">
                  <div class="p-col-6">
                    <div class="p-mb-2" *ngIf="portfolioStocks"><small><b># of Holdings:</b> {{ portfolioStocks.length }}</small></div>
                    <div class="p-mb-2" *ngIf="iexStockDataMap"><small><b>Top 10 Weighting:</b> {{ calculateTopTenTotalWeighting().toFixed(2) }}%</small></div>
                    <div class="p-mb-2" *ngIf="iexStockDataMap"><small><b>Top Holding: </b><a routerLink="/stocks/{{ getLargestHolding() }}">{{ getLargestHolding() }}</a></small></div>
                    <div class="p-mb-2" *ngIf="iexStockDataMap"><small><b>Top Country: </b>{{ getHighestWeightedIexCloudValue('country') }}</small></div>
                    <div class="p-mb-2" *ngIf="iexStockDataMap"><small><b>Top Sector: </b>{{ getHighestWeightedIexCloudValue('sector') }}</small></div>
                  </div>
                  <div class="p-col-6">
                    <div class="p-mb-2" *ngIf="iexStockDataMap"><small><b>Dividend Yield:</b> {{ (calculateWeightedAvg('dividendYield') * 100).toFixed(2) }}%</small></div>
                    <div class="p-mb-2" *ngIf="iexStockDataMap"><small><b>Market Cap:</b> {{ calculateWeightedAvg('marketcap') | abbreviatedCurrencyFormatterPipe }}</small></div>
                    <div class="p-mb-2" *ngIf="iexStockDataMap"><small><b>P/E Ratio:</b> {{ calculateWeightedAvg('peRatio').toFixed(2) }}</small></div>
                    <div class="p-mb-2" *ngIf="iexStockDataMap"><small><b>Beta:</b> {{ calculateWeightedAvg('beta').toFixed(2) }}</small></div>
                  </div>
                </div>
            </div>
        </div>

        <div class="p-col-12 p-md-6 p-xl-4">
            <div class="card product-list">
                <div class="card-header">
                    <h6>News</h6>
                </div>
                <ul>
                    <li>
                        <div class="product">
                            <img src="assets/layout/images/dashboard/image-product-1.png" alt="poseidon-layout" />
                            <div class="product-info">
                                <p>Nike Air X12</p>
                                <span>Sold <span>250</span> times</span>
                            </div>

                        </div>
                        <i class="pi pi-arrow-up"></i>
                    </li>
                    <li>
                        <div class="product">
                            <img src="assets/layout/images/dashboard/image-product-2.png" alt="poseidon-layout" />
                            <div class="product-info">
                                <p>Nike Sports Watch</p>
                                <span>Sold <span>189</span> times</span>
                            </div>

                        </div>
                        <i class="pi pi-arrow-up"></i>
                    </li>
                    <li>
                        <div class="product">
                            <img src="assets/layout/images/dashboard/image-product-3.png" alt="poseidon-layout" />
                            <div class="product-info">
                                <p>Heinz Yellow Mustard</p>
                                <span>Sold <span>24</span> times</span>
                            </div>

                        </div>
                        <i class="pi pi-arrow-up"></i>
                    </li>
                    <li>
                        <div class="product">
                            <img src="assets/layout/images/dashboard/image-product-4.png" alt="poseidon-layout" />
                            <div class="product-info">
                                <p>Beats Headphone</p>
                                <span>Sold <span>24</span> times</span>
                            </div>

                        </div>
                        <i class="pi pi-arrow-down down"></i>
                    </li>
                    <li>
                        <div class="product">
                            <img src="assets/layout/images/dashboard/image-product-5.png" alt="poseidon-layout" />
                            <div class="product-info">
                                <p>Black Racing Bike</p>
                                <span>Sold <span>24</span> times</span>
                            </div>

                        </div>
                        <i class="pi pi-arrow-up"></i>
                    </li>
                </ul>
            </div>
        </div>

        <div class="p-col-12 p-md-6 p-xl-4">
            <!-- <div class="card sellers">
                <div class="card-header">
                    <h6>Seller List</h6>
                </div>
                <ul>
                    <li>
                        <div class="seller">
                            <img src="assets/layout/images/dashboard/seller-1.png" alt="poseidon-layout" />
                            <p>Hector Mariano</p>
                        </div>
                        <span>Tier 1</span>
                        <p-rating [(ngModel)]="val2" readonly="true" stars="3"></p-rating>
                        <p-menu #menu1 [popup]="true" [model]="items"></p-menu>
                        <button type="button" pButton icon="pi pi-ellipsis-v" class="p-button-secondary p-button-outlined" (click)="menu1.toggle($event)"></button>
                    </li>
                    <li>
                        <div class="seller">
                            <img src="assets/layout/images/dashboard/seller-2.png" alt="poseidon-layout" />
                            <p>Maria Illescas</p>
                        </div>
                        <span>Tier 2</span>
                        <p-rating [(ngModel)]="val2" readonly="true" stars="3"></p-rating>
                        <p-menu #menu2 [popup]="true" [model]="items"></p-menu>
                        <button type="button" pButton icon="pi pi-ellipsis-v" class="p-button-secondary p-button-outlined" (click)="menu2.toggle($event)"></button>
                    </li>
                    <li>
                        <div class="seller">
                            <img src="assets/layout/images/dashboard/seller-3.png" alt="poseidon-layout" />
                            <p>Ngô Hải Giang</p>
                        </div>
                        <span>Tier 3</span>
                        <p-rating [(ngModel)]="val1" readonly="true" stars="3"></p-rating>
                        <p-menu #menu3 [popup]="true" [model]="items"></p-menu>
                        <button type="button" pButton icon="pi pi-ellipsis-v" class="p-button-secondary p-button-outlined" (click)="menu3.toggle($event)"></button>
                    </li>
                    <li>
                        <div class="seller">
                            <img src="assets/layout/images/dashboard/seller-4.png" alt="poseidon-layout" />
                            <p>Tamas Bunce</p>
                        </div>
                        <span>Tier 4</span>
                        <p-rating [(ngModel)]="val1" readonly="true" stars="3"></p-rating>
                        <p-menu #menu4 [popup]="true" [model]="items"></p-menu>
                        <button type="button" pButton icon="pi pi-ellipsis-v" class="p-button-secondary p-button-outlined" (click)="menu4.toggle($event)"></button>
                    </li>
                    <li>
                        <div class="seller">
                            <img src="assets/layout/images/dashboard/avatar-conan.png" alt="poseidon-layout" />
                            <p>Conan Matusov</p>
                        </div>
                        <span>Tier 4</span>
                        <p-rating [(ngModel)]="val1" readonly="true" stars="3"></p-rating>
                        <p-menu #menu5 [popup]="true" [model]="items"></p-menu>
                        <button type="button" pButton icon="pi pi-ellipsis-v" class="p-button-secondary p-button-outlined" (click)="menu5.toggle($event)"></button>
                    </li>
                    <li>
                        <div class="seller">
                            <img src="assets/layout/images/dashboard/leader-4.png" alt="poseidon-layout" />
                            <p>Maria Illescas</p>
                        </div>
                        <span>Tier 4</span>
                        <p-rating [(ngModel)]="val1" readonly="true" stars="3"></p-rating>
                        <p-menu #menu6 [popup]="true" [model]="items"></p-menu>
                        <button type="button" pButton icon="pi pi-ellipsis-v" class="p-button-secondary p-button-outlined" (click)="menu6.toggle($event)"></button>
                    </li>
                    <li>
                        <div class="seller">
                            <img src="assets/layout/images/dashboard/leader-3.png" alt="poseidon-layout" />
                            <p>Su Hua</p>
                        </div>
                        <span>Tier 4</span>
                        <p-rating [(ngModel)]="val1" readonly="true" stars="3"></p-rating>
                        <p-menu #menu7 [popup]="true" [model]="items"></p-menu>
                        <button type="button" pButton icon="pi pi-ellipsis-v" class="p-button-secondary p-button-outlined" (click)="menu7.toggle($event)"></button>
                    </li>
                </ul>
            </div> -->
        </div>

        <!-- <div class="p-col-12 p-md-6 p-xl-4">
            <div class="card tasks">
                <div class="card-header">
                    <h6>Tasks</h6>
                </div>
                <div>
                    <div class="task task-1">
                        <div class="task-info">
                            <div class="task-name"><span>12</span> Orders to fulfill</div>
                            <i class="pi pi-tag"></i>
                        </div>
                        <div class="task-progress">
                            <div></div>
                        </div>
                    </div>
                    <div class="task task-2">
                        <div class="task-info">
                            <div class="task-name"><span>40+</span> Payments to withdraw</div>
                            <i class="pi pi-money-bill"></i>
                        </div>
                        <div class="task-progress">
                            <div></div>
                        </div>
                    </div>
                    <div class="task task-3">
                        <div class="task-info">
                            <div class="task-name"><span>4</span> Reports to revise</div>
                            <i class="pi pi-file"></i>
                        </div>
                        <div class="task-progress">
                            <div></div>
                        </div>
                    </div>
                    <div class="task task-4">
                        <div class="task-info">
                            <div class="task-name"><span>6</span> Questions to respond</div>
                            <i class="pi pi-comment"></i>
                        </div>
                        <div class="task-progress">
                            <div></div>
                        </div>
                    </div>
                    <div class="task task-5">
                        <div class="task-info">
                            <div class="task-name"><span>2</span> Chargebacks to review</div>
                            <i class="pi pi-check-square"></i>
                        </div>
                        <div class="task-progress">
                            <div></div>
                        </div>
                    </div>
                    <div class="task task-1">
                        <div class="task-info">
                            <div class="task-name"><span>12</span> Orders to fulfill</div>
                            <i class="pi pi-tag"></i>
                        </div>
                        <div class="task-progress">
                            <div></div>
                        </div>
                    </div>
                    <div class="task task-2">
                        <div class="task-info">
                            <div class="task-name"><span>40+</span> Payments to withdraw</div>
                            <i class="pi pi-money-bill"></i>
                        </div>
                        <div class="task-progress">
                            <div></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="p-col-12 p-xl-8">
            <div class="card sales">
                <div class="card-header">
                    <h4>Recent Sales</h4>
                    <p-dropdown [options]="orderWeek" [(ngModel)]="selectedOrderWeek" optionLabel="name" (onChange)="recentSales($event)"
                                styleClass="dashbard-demo-dropdown" [ngStyle]="{'min-width': '8rem'}"></p-dropdown>
                </div>

                <p>Your sales activity over time.</p>


                <p-table [value]="products" [paginator]="true" [rows]="5" styleClass="p-datatable-customers">
                    <ng-template pTemplate="header">
                        <tr>
                            <th pSortableColumn="id">ID
                                <p-sortIcon field="id"></p-sortIcon>
                            </th>
                            <th pSortableColumn="category">Category
                                <p-sortIcon field="category"></p-sortIcon>
                            </th>
                            <th pSortableColumn="price">Price
                                <p-sortIcon field="price"></p-sortIcon>
                            </th>
                            <th pSortableColumn="inventoryStatus">Status
                                <p-sortIcon field="inventoryStatus"></p-sortIcon>
                            </th>
                            <th></th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-product>
                        <tr>
                            <td>
                                <span class="p-column-title">Id</span>
                                {{product.id}}</td>
                            <td>
                                <span class="p-column-title">Category</span>
                                {{product.category}}</td>
                            <td>
                                <span class="p-column-title">Price</span>
                                {{product.price | currency:'USD'}}</td>
                            <td>
                                <span class="p-column-title">Status</span>
                                <span
                                    [class]="'product-badge status-' + product.inventoryStatus.toLowerCase()">{{product.inventoryStatus}}</span>
                            </td>
                            <td style="text-align: center">
                                <button pButton type="button" icon="pi pi-search"></button>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div> -->
    </div>
</div>
